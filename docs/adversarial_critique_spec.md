# 敵対的評価ループ (Adversarial Grant Critique) 仕様書

## 概要

「書いて終わり」ではなく「自分でダメ出しして書き直す」AIシステム。
**Writer Agent**（DrafterAgent）と **Critic Agent**（新規）による自動推敲を実装。

---

## 機能詳細

### 1. 推敲ループ (Revision Loop)

**処理フロー:**
1. Writer が初回ドラフトを生成
2. Critic が評価（5軸 × 20点 = 100点満点）
3. 80点未満なら修正指示を生成
4. Writer が修正版を作成
5. 2-4を最大3回繰り返し

**合格条件:** 総合スコア80点以上

---

### 2. Critic Agent 評価観点

| 観点 | 配点 | 評価内容 |
|------|------|----------|
| 社会的インパクト | 20点 | 数値目標、受益者数、成果指標の具体性 |
| 予算の妥当性 | 20点 | 積算根拠、費用対効果の明確さ |
| 実現可能性 | 20点 | 実施体制、スケジュールの具体性 |
| 独自性・差別化 | 20点 | 他団体との違い、新規性 |
| 団体の信頼性 | 20点 | 実績、専門性、継続性 |

---

### 3. Discord通知（思考プロセス可視化）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 推敲ループ Round 1/3
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✍️ Writer: 初回ドラフトを提出しました

🔍 Critic 思考プロセス:
├─ 🟡 社会的インパクト: 15/20点
├─ 🔴 予算の妥当性: 12/20点
├─ 🟢 実現可能性: 18/20点
├─ 🔴 独自性: 10/20点
├─ 🟡 団体信頼性: 16/20点
├─────────────────────────────
│  📊 総合スコア: 71点
│  ❌ 判定: 不採択
└─────────────────────────────

📝 修正指示:
   1. 受益者数を具体化
   2. 予算の積算根拠を明記
   3. DX文脈を強化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 実装ファイル

| ファイル | 役割 |
|---------|------|
| `src/agents/critic.py` | Critic Agent本体 |
| `src/agents/drafter.py` | 統合処理（Step 3.5で推敲ループ呼び出し） |
| `config/prompts.yaml` | `critic`, `revision_writer` プロンプト |

---

## 設定パラメータ

| パラメータ | デフォルト値 | 説明 |
|-----------|-------------|------|
| `pass_threshold` | 80 | 合格スコア閾値 |
| `max_iterations` | 3 | 最大ループ回数 |

---

## 出力

- **最終ドラフト**: 推敲後の改善版ドラフト
- **議論ログ**: AI同士のやり取り履歴
- **最終スコア**: 5軸評価の詳細

---

## 事務局長レビューとの統合

> [!NOTE]
> 従来の `_generate_director_review()` はこの機能に**統合・廃止**されました。

**統合理由:**
- 両者とも「審査員視点でのレビュー」を行う重複機能だった
- Critic Agentは推敲ループ付きでより高度な評価が可能

**変更点:**
- `DrafterAgent._generate_director_review()` → 削除
- 最終評価結果は `dialogue_log_text` として出力

