# ドラフト品質レポート＆事務局長レビュー機能 仕様書

## 概要

ドラフト作成時に以下の情報を自動生成：
1. **懸念点レポート**: 情報不足や確認が必要な項目を報告
2. **事務局長レビュー**: 申請書全体に対するレビューコメント

---

## 機能詳細

### 1. 懸念点レポート

**検出タイプ**:
- `missing_info`: プロファイルに情報がなく回答できなかった
- `uncertain`: 回答したが確認が必要

**仕組み**:
1. プロンプトでLLMに懸念点タグを付記させる
   - `[MISSING_INFO: 理由]`
   - `[UNCERTAIN: 理由]`
2. レスポンスからタグを抽出し、valueから除去
3. `generate_concern_report()`でMarkdownレポート生成

**出力例**:
```markdown
## ⚠️ 懸念点レポート

### 📋 情報不足で埋められなかった項目
- **代表者名**: プロファイルに情報がありません

### ❓ 確認が必要な項目
- **予算計画**: 概算値を入力しました
```

---

### 2. 事務局長レビュー

**仕組み**:
1. 入力されたフィールド値とプロファイルをLLMに送信
2. 事務局長視点でレビューコメントを生成

**レビュー観点**:
- 全体評価
- 強み
- 改善提案
- 確認事項

**出力例**:
```markdown
## 📝 事務局長レビュー

申請書は全体として良くまとまっています。特に事業概要の
具体性は評価できます。改善点としては、予算の根拠をより
詳細に記載することをお勧めします。提出前に理事会での
承認状況を確認してください。
```

---

## 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `format_field_mapper.py` | プロンプト拡張、タグ抽出、`generate_concern_report()` |
| `drafter.py` | `_generate_director_review()`, `create_draft`への統合 |

---

## データ構造

### field_values（懸念点情報追加後）
```python
{
    "field_id": {
        "value": "入力値",
        "field_name": "項目名",
        "concern_type": "none" | "missing_info" | "uncertain",
        "concern_reason": "理由",
        "input_length_type": "short" | "long" | "unknown",
        ...
    }
}
```
